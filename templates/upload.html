{% extends 'base.html' %}
{% block content %}
<div class="d-flex align-items-center justify-content-between flex-wrap gap-3 mb-4">
  <div>
    <h1 class="mb-1">ğŸ“ Upload Games</h1>
    <p class="subtle mb-0">Welcome back, {{ username }}! Add your PGN files to start training.</p>
  </div>
  <div class="d-flex gap-2 flex-wrap">
    <span class="badge-soft">Max {{ opening_plies_limit }} plies</span>
    <span class="badge-soft">Up to {{ max_games }} games</span>
    <span class="badge-soft">â‰¤ {{ max_file_size_mb }}MB files</span>
  </div>
</div>

<div class="row g-4">
  <!-- Upload Form -->
  <div class="col-lg-7">
    <div class="card p-4">
      <div class="section-title mb-3">
        <h4 class="mb-0">ğŸ“¤ Upload PGN Files</h4>
        <span class="badge-soft">.pgn format</span>
      </div>
      
      <form action="/upload" method="post" enctype="multipart/form-data" id="uploadForm">
        <div class="row g-4">
          <!-- White Upload -->
          <div class="col-md-6">
            <div class="p-3 rounded" style="background: rgba(255,255,255,0.02); border: 1px dashed var(--border);">
              <div class="d-flex align-items-center gap-2 mb-2">
                <span style="font-size: 1.5rem;">â¬œ</span>
                <div>
                  <div class="fw-semibold">White Games</div>
                  <div class="text-muted small">Your games as white</div>
                </div>
              </div>
              <input type="file" name="white_pgn" class="form-control" multiple accept=".pgn">
              {% if white_status.has_pgn %}
              <div class="mt-2">
                <span class="status-badge success">
                  <span class="status-dot"></span>
                  Data uploaded
                </span>
              </div>
              {% endif %}
            </div>
          </div>
          
          <!-- Black Upload -->
          <div class="col-md-6">
            <div class="p-3 rounded" style="background: rgba(255,255,255,0.02); border: 1px dashed var(--border);">
              <div class="d-flex align-items-center gap-2 mb-2">
                <span style="font-size: 1.5rem;">â¬›</span>
                <div>
                  <div class="fw-semibold">Black Games</div>
                  <div class="text-muted small">Your games as black</div>
                </div>
              </div>
              <input type="file" name="black_pgn" class="form-control" multiple accept=".pgn">
              {% if black_status.has_pgn %}
              <div class="mt-2">
                <span class="status-badge success">
                  <span class="status-dot"></span>
                  Data uploaded
                </span>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
        
        <div class="d-flex gap-3 mt-4 flex-wrap">
          <button type="submit" class="btn btn-primary btn-lg flex-grow-1" id="submitBtn">
            ğŸ“¤ Upload & Train
          </button>
          <a href="{{ url_for('train') }}" class="btn btn-outline-light btn-lg">
            Skip to Train â†’
          </a>
        </div>
      </form>
      
      {% if white_status.has_pgn or black_status.has_pgn %}
      <hr class="my-4" style="border-color: var(--border);">
      <form action="/clear_pgns" method="post" onsubmit="return confirm('This will delete all your uploaded games and analysis. Continue?')">
        <button type="submit" class="btn btn-outline-danger">
          ğŸ—‘ï¸ Clear All Data
        </button>
      </form>
      {% endif %}
    </div>
  </div>
  
  <!-- Tips & Info -->
  <div class="col-lg-5">
    <div class="card p-4 h-100">
      <h5 class="mb-3">ğŸ’¡ Tips for Best Results</h5>
      
      <div class="mb-3">
        <div class="d-flex align-items-start gap-2 mb-2">
          <span>ğŸ“Š</span>
          <div>
            <div class="fw-semibold">Use OpeningTree</div>
            <p class="text-muted small mb-0">
              Export your games from <a href="https://www.openingtree.com/" target="_blank">OpeningTree</a> 
              for best quality opening data.
            </p>
          </div>
        </div>
      </div>
      
      <div class="mb-3">
        <div class="d-flex align-items-start gap-2 mb-2">
          <span>ğŸ¯</span>
          <div>
            <div class="fw-semibold">Separate by Color</div>
            <p class="text-muted small mb-0">
              Keep White and Black files separate for faster analysis and targeted training.
            </p>
          </div>
        </div>
      </div>
      
      <div class="mb-3">
        <div class="d-flex align-items-start gap-2 mb-2">
          <span>ğŸ”„</span>
          <div>
            <div class="fw-semibold">Re-upload Regularly</div>
            <p class="text-muted small mb-0">
              Add new games periodically. Old analysis is cleared automatically on new uploads.
            </p>
          </div>
        </div>
      </div>
      
      <div class="mb-3">
        <div class="d-flex align-items-start gap-2 mb-2">
          <span>â±ï¸</span>
          <div>
            <div class="fw-semibold">Background Processing</div>
            <p class="text-muted small mb-0">
              Analysis runs in the background. You can navigate away and return later.
            </p>
          </div>
        </div>
      </div>
      
      <div class="alert alert-info mb-0 mt-auto">
        <strong>â„¹ï¸ Note:</strong> Only the first {{ opening_plies_limit }} plies ({{ opening_plies_limit // 2 }} moves) 
        of each game are analyzed to focus on opening preparation.
      </div>
    </div>
  </div>
</div>

<script>
document.getElementById('uploadForm').addEventListener('submit', function(e) {
  const whiteFiles = document.querySelector('input[name="white_pgn"]').files;
  const blackFiles = document.querySelector('input[name="black_pgn"]').files;
  
  if (whiteFiles.length === 0 && blackFiles.length === 0) {
    e.preventDefault();
    showToast('Please select at least one PGN file.', 'warning');
    return false;
  }
  
  // Show loading state
  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="processing-indicator"><span class="processing-dot"></span><span class="processing-dot"></span><span class="processing-dot"></span></span> Uploading...';
});
</script>
{% endblock %}
