<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analysis</title>
    <link rel="stylesheet" href="https://unpkg.com/cm-chessboard/styles/cm-chessboard.css"/>
    <style>
        body { font-family: sans-serif; max-width: 900px; margin:auto; padding:2em; }
        .board { width: 300px; height: 300px; }
        #controls { margin-top: 1em; }
    </style>
</head>
<body>
<h1>Training Board</h1>
<div id="board" class="board"></div>
<div id="info"></div>
<input id="moveInput" placeholder="e2e4">
<button onclick="checkMove()">Check Move</button>
<div id="controls">
  <button onclick="prev()">Previous</button>
  <button onclick="next()">Next</button>
</div>
<script type="module">
import { Chessboard } from "https://unpkg.com/cm-chessboard/src/cm-chessboard/Chessboard.js";
const mistakes = {{ mistakes|tojson }};
let index = 0;
const board = new Chessboard(document.getElementById("board"), {
    position: mistakes.length ? mistakes[0].fen : "",
    style: {
        aspectRatio: 1,
        pieces: { file: "https://unpkg.com/cm-chessboard/assets/pieces/staunty.svg" }
    }
});
function show(){
    if(!mistakes.length) return;
    const m = mistakes[index];
    board.setPosition(m.fen);
    document.getElementById("info").innerHTML = `<p>Frequency: ${m.game_count}</p><p>Your move: ${m.user_move}</p>`;
    document.getElementById("moveInput").value = "";
}
function checkMove(){
    const move = document.getElementById("moveInput").value.trim();
    if(!move) return;
    const m = mistakes[index];
    if(m.top_moves.includes(move)) alert("Good move!");
    else alert("Not a top move");
}
function prev(){ if(index>0){ index--; show(); } }
function next(){ if(index < mistakes.length-1){ index++; show(); } }
show();
</script>
</body>
</html>
