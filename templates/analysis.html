<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analysis</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/css/chessboard.min.css"/>
    <style>
        body { font-family: sans-serif; max-width: 900px; margin:auto; padding:2em; }
        #board { width: 400px; margin:auto; }
        #controls { margin-top: 1em; }
    </style>
</head>
<body>
<h1>Training Board</h1>
<div id="board"></div>
<div id="info"></div>
<input id="moveInput" placeholder="e2e4">
<button onclick="checkMove()">Check Move</button>
<div id="controls">
  <button onclick="prev()">Previous</button>
  <button onclick="next()">Next</button>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/js/chessboard.min.js"></script>
<script>
const mistakes = {{ mistakes|tojson }};
let index = 0;
const board = Chessboard('board', {position: mistakes.length ? mistakes[0].fen : 'start'});
function show(){
    if(!mistakes.length) return;
    const m = mistakes[index];
    board.position(m.fen);
    document.getElementById("info").innerHTML = `<p>Frequency: ${m.game_count}</p><p>Your move: ${m.user_move}</p>`;
    document.getElementById("moveInput").value = "";
}
function checkMove(){
    const move = document.getElementById("moveInput").value.trim();
    if(!move) return;
    const m = mistakes[index];
    if(m.top_moves.includes(move)) alert("Good move!");
    else alert("Not a top move");
}
function prev(){ if(index>0){ index--; show(); } }
function next(){ if(index < mistakes.length-1){ index++; show(); } }
show();
</script>
</body>
</html>
