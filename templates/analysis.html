<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analysis</title>
    <style>
        body { font-family: sans-serif; max-width: 900px; margin:auto; padding:2em; }
        #board { width: 100%; aspect-ratio: 4/3; }
        #controls { margin-top: 1em; }
    </style>
</head>
<body>
<h1>Training Board</h1>
<iframe id="board" frameborder="0"></iframe>
<div id="info"></div>
<input id="moveInput" placeholder="e2e4">
<button onclick="checkMove()">Check Move</button>
<div id="controls">
  <button onclick="prev()">Previous</button>
  <button onclick="next()">Next</button>
</div>
<script>
const mistakes = {{ mistakes|tojson }};
let index = 0;
function show(){
    if(!mistakes.length) return;
    const m = mistakes[index];
    const orientation = m.fen.split(' ')[1] === 'w' ? 'white' : 'black';
    document.getElementById('board').src =
        `https://lichess.org/embed/analysis?fen=${encodeURIComponent(m.fen)}&color=${orientation}`;
    document.getElementById("info").innerHTML = `<p>Frequency: ${m.game_count}</p><p>Your move: ${m.user_move}</p>`;
    document.getElementById("moveInput").value = "";
}
function checkMove(){
    const move = document.getElementById("moveInput").value.trim();
    if(!move) return;
    const m = mistakes[index];
    if(m.top_moves.includes(move)) alert("Good move!");
    else alert("Not a top move");
}
function prev(){ if(index>0){ index--; show(); } }
function next(){ if(index < mistakes.length-1){ index++; show(); } }
show();
</script>
</body>
</html>
