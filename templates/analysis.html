<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analysis</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard.min.css" integrity="sha512-1PJ8wjYoB2ZUAMo6ckFELjaRyvOz1ivQAYdhbbQq3DYb8CxGtEiL+ptIpVc8D4KgcBJsIYX6OGpgCoHhXJDFJQ==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <style>
        body { font-family: sans-serif; max-width: 900px; margin:auto; padding:2em; }
        .board { width: 300px; height: 300px; }
        #controls { margin-top: 1em; }
    </style>
</head>
<body>
<h1>Training Board</h1>
<div id="board" class="board"></div>
<div id="info"></div>
<input id="moveInput" placeholder="e2e4">
<button onclick="checkMove()">Check Move</button>
<div id="controls">
  <button onclick="prev()">Previous</button>
  <button onclick="next()">Next</button>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard.min.js" integrity="sha512-0WexkLLdAYMt5C0/EQtYFq8QcPfrblu3Wkuk37lcH0YqhJ++cD27uYk2cEy/s8X3H559eCQ9L+R7r7BbK46+CQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const mistakes = {{ mistakes|tojson }};
let index = 0;
let board;
$(function(){
    board = Chessboard('board', {
        position: mistakes.length ? mistakes[0].fen : 'start',
        pieceTheme: 'https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/img/chesspieces/wikipedia/{piece}.png'
    });
    show();
});
function show(){
    if(!mistakes.length) return;
    const m = mistakes[index];
    board.position(m.fen);
    document.getElementById("info").innerHTML = `<p>Frequency: ${m.game_count}</p><p>Your move: ${m.user_move}</p>`;
    document.getElementById("moveInput").value = "";
}
function checkMove(){
    const move = document.getElementById("moveInput").value.trim();
    if(!move) return;
    const m = mistakes[index];
    if(m.top_moves.includes(move)) alert("Good move!");
    else alert("Not a top move");
}
function prev(){ if(index>0){ index--; show(); } }
function next(){ if(index < mistakes.length-1){ index++; show(); } }
</script>
</body>
</html>
